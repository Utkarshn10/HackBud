{"version":3,"file":"exception-autocapture.js","sourceRoot":"","sources":["../../../src/entrypoints/exception-autocapture.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,iBAAiB,EAAE,8BAA8B,EAAE,MAAM,sDAAsD,CAAA;AACxH,OAAO,EAAE,gBAAgB,EAAE,MAAM,EAAE,MAAM,kBAAkB,CAAA;AAE3D,OAAO,EAAE,MAAM,EAAE,MAAM,iBAAiB,CAAA;AAExC,IAAM,WAAW,GAAG,UAAC,SAAsC;IACvD,IAAM,GAAG,GAAG,MAAa,CAAA;IACzB,IAAI,CAAC,GAAG,EAAE,CAAC;QACP,MAAM,CAAC,IAAI,CAAC,2CAA2C,CAAC,CAAA;IAC5D,CAAC;IACD,IAAM,eAAe,GAAG,GAAG,CAAC,OAAO,CAAA;IAEnC,GAAG,CAAC,OAAO,GAAG;;QAAU,cAAuB;aAAvB,UAAuB,EAAvB,qBAAuB,EAAvB,IAAuB;YAAvB,yBAAuB;;QAC3C,IAAM,eAAe,GAAG,iBAAiB,CAAC,IAAI,CAAC,CAAA;QAC/C,SAAS,CAAC,eAAe,CAAC,CAAA;QAC1B,OAAO,MAAA,eAAe,aAAf,eAAe,uBAAf,eAAe,wCAAM,IAAI,UAAC,mCAAI,KAAK,CAAA;IAC9C,CAAC,CAAA;IACD,GAAG,CAAC,OAAO,CAAC,wBAAwB,GAAG,IAAI,CAAA;IAE3C,OAAO;;QACI,MAAA,GAAG,CAAC,OAAO,+CAAE,wBAAwB,CAAA;QAC5C,GAAG,CAAC,OAAO,GAAG,eAAe,CAAA;IACjC,CAAC,CAAA;AACL,CAAC,CAAA;AAED,IAAM,sBAAsB,GAAG,UAAC,SAAsC;IAClE,IAAM,GAAG,GAAG,MAAa,CAAA;IACzB,IAAI,CAAC,GAAG,EAAE,CAAC;QACP,MAAM,CAAC,IAAI,CAAC,wDAAwD,CAAC,CAAA;IACzE,CAAC;IAED,IAAM,4BAA4B,GAAG,GAAG,CAAC,oBAAoB,CAAA;IAE7D,GAAG,CAAC,oBAAoB,GAAG;;QAAU,cAAoC;aAApC,UAAoC,EAApC,qBAAoC,EAApC,IAAoC;YAApC,yBAAoC;;QACrE,IAAM,eAAe,GAAG,8BAA8B,CAAC,IAAI,CAAC,CAAA;QAC5D,SAAS,CAAC,eAAe,CAAC,CAAA;QAC1B,OAAO,MAAA,4BAA4B,aAA5B,4BAA4B,uBAA5B,4BAA4B,CAAE,KAAK,CAAC,GAAG,EAAE,IAAI,CAAC,mCAAI,KAAK,CAAA;IAClE,CAAC,CAAA;IACD,GAAG,CAAC,oBAAoB,CAAC,wBAAwB,GAAG,IAAI,CAAA;IAExD,OAAO;;QACI,MAAA,GAAG,CAAC,oBAAoB,+CAAE,wBAAwB,CAAA;QACzD,GAAG,CAAC,oBAAoB,GAAG,4BAA4B,CAAA;IAC3D,CAAC,CAAA;AACL,CAAC,CAAA;AAED,IAAM,6BAA6B,GAAG;IAClC,WAAW,aAAA;IACX,sBAAsB,wBAAA;CACzB,CAAA;AAED,gBAAgB,CAAC,qBAAqB,GAAG,gBAAgB,CAAC,qBAAqB,IAAI,EAAE,CAAA;AACrF,gBAAgB,CAAC,qBAAqB,CAAC,sBAAsB,GAAG,6BAA6B,CAAA;AAC7F,gBAAgB,CAAC,qBAAqB,CAAC,sBAAsB,GAAG,iBAAiB,CAAA;AAEjF,+EAA+E;AAC/E,kGAAkG;AAClG,QAAQ;AACR,6CAA6C;AAC7C,2EAA2E;AAC3E,gBAAgB,CAAC,6BAA6B,GAAG,6BAA6B,CAAA;AAC9E,gBAAgB,CAAC,sBAAsB,GAAG,iBAAiB,CAAA;AAE3D,eAAe,6BAA6B,CAAA","sourcesContent":["import { errorToProperties, unhandledRejectionToProperties } from '../extensions/exception-autocapture/error-conversion'\nimport { assignableWindow, window } from '../utils/globals'\nimport { ErrorEventArgs, Properties } from '../types'\nimport { logger } from '../utils/logger'\n\nconst wrapOnError = (captureFn: (props: Properties) => void) => {\n    const win = window as any\n    if (!win) {\n        logger.info('window not available, cannot wrap onerror')\n    }\n    const originalOnError = win.onerror\n\n    win.onerror = function (...args: ErrorEventArgs): boolean {\n        const errorProperties = errorToProperties(args)\n        captureFn(errorProperties)\n        return originalOnError?.(...args) ?? false\n    }\n    win.onerror.__POSTHOG_INSTRUMENTED__ = true\n\n    return () => {\n        delete win.onerror?.__POSTHOG_INSTRUMENTED__\n        win.onerror = originalOnError\n    }\n}\n\nconst wrapUnhandledRejection = (captureFn: (props: Properties) => void) => {\n    const win = window as any\n    if (!win) {\n        logger.info('window not available, cannot wrap onUnhandledRejection')\n    }\n\n    const originalOnUnhandledRejection = win.onunhandledrejection\n\n    win.onunhandledrejection = function (...args: [ev: PromiseRejectionEvent]): boolean {\n        const errorProperties = unhandledRejectionToProperties(args)\n        captureFn(errorProperties)\n        return originalOnUnhandledRejection?.apply(win, args) ?? false\n    }\n    win.onunhandledrejection.__POSTHOG_INSTRUMENTED__ = true\n\n    return () => {\n        delete win.onunhandledrejection?.__POSTHOG_INSTRUMENTED__\n        win.onunhandledrejection = originalOnUnhandledRejection\n    }\n}\n\nconst posthogErrorWrappingFunctions = {\n    wrapOnError,\n    wrapUnhandledRejection,\n}\n\nassignableWindow.__PosthogExtensions__ = assignableWindow.__PosthogExtensions__ || {}\nassignableWindow.__PosthogExtensions__.errorWrappingFunctions = posthogErrorWrappingFunctions\nassignableWindow.__PosthogExtensions__.parseErrorAsProperties = errorToProperties\n\n// we used to put these on window, and now we put them on __PosthogExtensions__\n// but that means that old clients which lazily load this extension are looking in the wrong place\n// yuck,\n// so we also put them directly on the window\n// when 1.161.1 is the oldest version seen in production we can remove this\nassignableWindow.posthogErrorWrappingFunctions = posthogErrorWrappingFunctions\nassignableWindow.parseErrorAsProperties = errorToProperties\n\nexport default posthogErrorWrappingFunctions\n"]}